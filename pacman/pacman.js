"use strict"

var keypressed = -1; // no keypressed

function gameLoop() { // main loop of the game
    var grid = {"width": 56,//it it possible to use cell.lenght instead of this
	        "height":62,
	   "cell":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
               	   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,3,3,3,3,1,1,3,3,3,3,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,1,1,1,1,1,1,3,3,3,3,1,1,3,3,3,3,1,1,1,1,1,1,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,5,5,5,5,5,4,4,4,4,5,5,5,5,5,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,3,3,3,3,5,8,8,8,8,8,8,8,8,8,8,8,8,5,3,3,3,3,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0],
		   [3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,5,8,8,8,8,8,8,8,8,8,8,8,8,5,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3],
		   [3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,5,8,8,8,8,8,8,8,8,8,8,8,8,5,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3],
		   [3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,5,8,8,8,8,8,8,8,8,8,8,8,8,5,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3],
		   [3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,5,8,8,8,8,8,8,8,8,8,8,8,8,5,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3],
		   [8,8,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,3,3,3,3,5,8,8,8,8,8,8,8,8,8,8,8,8,5,3,3,3,3,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,5,5,5,5,5,5,5,5,5,5,5,5,5,5,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [8,8,8,8,8,8,8,8,8,8,1,0,0,0,0,1,1,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,1,1,0,0,0,0,1,8,8,8,8,8,8,8,8,8,8],
		   [1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1],
		   [1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1],
		   [1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
		   [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
	           [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
		  ],
		"state":0, // state of the game
		"ghostx": 21, "ghosty": 25, // ghost house (for drawing)
		"ghosthome":{"x":26, "y":21, "xx":26, "yy":27}, // ghost home
		"combuffer":-1, // command buffer
		"pacman":{"x": 26, "y":45, "dir":0, "speed":0.64, "stop":0, "pphase":0, "width":4, "height":4, "anim1":0},
		"ghost": [
		    {"color":"#FF3311", "eyecolor":"#0000FF",
		     "bcolor":"#0033CC", "wcolor":"#FFFFFF", "ecolor":"#FFFFFF", "rcolor":"#FF0000",
		     "speed":0.50, "defaultspeed":0.50, "slowspeed":0.25, "espeed":0.99, "e":false,
		     "x":26, "y":21, "dir":3, "al":1, "width":4, "height":4, "w":0},
	            {"color":"#FFAAAA", "eyecolor":"#0000FF",
		     "bcolor":"#0033CC", "wcolor":"#FFFFFF", "ecolor":"#FFFFFF", "rcolor":"#FF0000",
		     "speed":0.5, "defaultspeed":0.50, "slowspeed":0.25, "espeed":0.99, "e":false,
		     "x":26, "y":27, "dir":3, "al":-1, "width":4, "height":4, "w":0},
		    {"color":"#33CCFF", "eyecolor":"#0000FF",
		     "bcolor":"#0033CC", "wcolor":"#FFFFFF", "ecolor":"#FFFFFF", "rcolor":"#FF0000",
		     "speed":0.5, "defaultspeed":0.50, "slowspeed":0.25, "espeed":0.99, "e":false,
		     "x":22, "y":27, "dir":1, "al":-2, "width":4, "height":4, "w":0},
	            {"color":"#FFBB33", "eyecolor":"#0000FF",
		     "bcolor":"#0033CC", "wcolor":"#FFFFFF", "ecolor":"#FFFFFF", "rcolor":"#FF0000",
		     "speed":0.5, "defaultspeed":0.50, "slowspeed":0.25, "espeed":0.99, "e":false,
		     "x":30, "y":27, "dir":1, "al":-3, "width":4, "height":4, "w":0}
			 ],
	        "phase":0};
    var dots = [];
    getDots(dots, Object.seal(grid));
    
    myInt = setInterval(function drawHelper() {draw(Object.seal(grid), Object.seal(dots))}, 100);
    //draw(grid, dots);
}
var myInt; // interval

function inputUp() {
    keypressed = 1;
}
function inputDown() {
    keypressed = 3;
}
function inputLeft() {
    keypressed = 0;
}
function inputRight() {
    keypressed = 2;
}

function inputFunct(event) {
    var x = event.clientX;
    var y = event.clientY;
    // todo: etc...
}
